<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pension Calculator</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .data {
            border-collapse: collapse;
            width: 100%;
        }
        .data th, .data td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .data th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #4CAF50;
            color: white;
        }
        .disclaimer {
            font-size: 0.9em;
            color: #888;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P1BR1VP1QT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-P1BR1VP1QT');
    </script>
</head>
<body>
    <div class="container">
        <h1 class="mt-4">UCLA Pension Calculator</h1>
        <form id="pensionForm" class="mb-4">
            <div class="form-group">
                <label for="currentAge">Current Age:</label>
                <input type="number" id="currentAge" name="currentAge" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="startDateYear">Employment Start Year:</label>
                <input type="number" id="startDateYear" name="startDateYear" class="form-control" required>
            </div>
            <div id="startMonthContainer" class="form-group" style="display:none;">
                <label for="startMonth">Employment Start Month:</label>
                <select id="startMonth" name="startMonth" class="form-control">
                    <option value="">Select Month</option>
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
            </div>
            <div class="form-group">
                <label for="hapc">Highest Average Salary (HAPC):</label>
                <input type="number" step="0.01" id="hapc" name="hapc" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Calculate</button>
            <button type="button" class="btn btn-secondary" id="clearButton">Clear</button>
        </form>

        <h2 id="resultsHeader" class="d-none">Pension Calculation Results</h2>
        <div id="results" class="table-responsive d-none"></div>
        <div id="pensionGraph" class="mt-4 d-none"></div>
        <p class="disclaimer mt-4">This calculator provides rough estimates. Please double-check the calculations when you are planning for retirement.</p>
    </div>

    <script>
        document.getElementById('startDateYear').addEventListener('input', function() {
            var yearInput = this.value;
            var startMonthContainer = document.getElementById('startMonthContainer');
            
            if (yearInput === '2013') {
                startMonthContainer.style.display = 'block';
            } else {
                startMonthContainer.style.display = 'none';
            }
        });

        document.getElementById('pensionForm').addEventListener('submit', function(event) {
            event.preventDefault();
            calculatePension();
        });

        document.getElementById('clearButton').addEventListener('click', function() {
            clearForm();
        });
        

        function calculatePension() {
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const startDateYear = parseInt(document.getElementById('startDateYear').value);
            const hapc = parseFloat(document.getElementById('hapc').value);
            const startDateMonth = parseInt(document.getElementById('startMonth').value);

            const currentYear = new Date().getFullYear();
            let ageFactors;

            if (startDateYear < 2013 || (startDateYear == 2013 && startDateMonth < 7)) {
                ageFactors = {
                    50: 0.0110,
                    51: 0.0124,
                    52: 0.0138,
                    53: 0.0152,
                    54: 0.0166,
                    55: 0.0180,
                    56: 0.0194,
                    57: 0.0208,
                    58: 0.0222,
                    59: 0.0236,
                    60: 0.0250
                };
            } else {
                ageFactors = {
                    55: 0.0110,
                    56: 0.0124,
                    57: 0.0138,
                    58: 0.0152,
                    59: 0.0166,
                    60: 0.0180,
                    61: 0.0194,
                    62: 0.0208,
                    63: 0.0222,
                    64: 0.0236,
                    65: 0.0250
                };
            }

            const retirementAges = Object.keys(ageFactors).map(age => parseInt(age));
            const results = [];

            retirementAges.forEach(age => {
                const retirementYear = currentYear + (age - currentAge);
                const serviceYears = retirementYear - startDateYear;
                const ageFactor = ageFactors[age];
                const benefitPercentage = serviceYears * ageFactor;
                const yearlyPension = benefitPercentage * hapc;
                const monthlyPension = yearlyPension / 12;

                results.push({
                    retirementAge: age,
                    retirementYear: retirementYear,
                    monthlyPension: monthlyPension,
                    yearlyPension: yearlyPension,
                    serviceYears: serviceYears,
                    benefitPercentage: benefitPercentage * 100
                });
            });

            displayResults(results);
            displayGraph(results);
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (results.length > 0) {
                const table = document.createElement('table');
                table.classList.add('data', 'table', 'table-bordered', 'table-striped');

                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');

                ['Retirement Age', 'Retirement Year', 'Monthly Pension ($)', 'Yearly Pension ($)', 'Service Years', 'Benefit Percentage (%)'].forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });

                thead.appendChild(headerRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');

                results.forEach(result => {
                    const row = document.createElement('tr');

                    const formattedResult = {
                        retirementAge: result.retirementAge.toFixed(0),
                        retirementYear: result.retirementYear,
                        monthlyPension: result.monthlyPension.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 }),
                        yearlyPension: result.yearlyPension.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 }),
                        serviceYears: result.serviceYears.toFixed(0),
                        benefitPercentage: result.benefitPercentage.toFixed(2) + '%'
                    };

                    Object.values(formattedResult).forEach(value => {
                        const td = document.createElement('td');
                        td.textContent = value;
                        row.appendChild(td);
                    });

                    tbody.appendChild(row);
                });

                table.appendChild(tbody);
                resultsDiv.appendChild(table);
                document.getElementById('resultsHeader').classList.remove('d-none');
                resultsDiv.classList.remove('d-none');
                document.getElementById('pensionGraph').classList.remove('d-none');
            } else {
                resultsDiv.textContent = 'No results to display.';
            }
        }

        function displayGraph(results) {
            const retirementAges = results.map(result => result.retirementAge);
            const yearlyPensions = results.map(result => result.yearlyPension);

            const trace = {
                x: retirementAges,
                y: yearlyPensions,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Yearly Pension',
                text: results.map(result => `cd ..
                
                    Retirement Age: ${result.retirementAge}<br>
                    Retirement Year: ${result.retirementYear}<br>
                    Monthly Pension: ${result.monthlyPension.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })}<br>
                    Yearly Pension: ${result.yearlyPension.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })}<br>
                    Service Years: ${result.serviceYears}<br>
                    Benefit Percentage: ${result.benefitPercentage.toFixed(2)}%
                `),
                hoverinfo: 'text'
            };

            const layout = {
                title: 'UCLA Pension Based on Retirement Age',
                xaxis: { title: 'Retirement Age' },
                yaxis: { title: 'Pension Amount ($)' },
                hovermode: 'closest',
                dragmode: false // Disable dragging on the graph
            };

            const config = {
                displayModeBar: false, // Hide the mode bar
                responsive: true,
                scrollZoom: false, // Disable scroll to zoom
                doubleClick: false, // Disable double-click zoom
                showTips: false // Disable additional tips
            };

            Plotly.newPlot('pensionGraph', [trace], layout, config);
        }

        function clearForm() {
            document.getElementById('pensionForm').reset();
            document.getElementById('resultsHeader').classList.add('d-none');
            document.getElementById('results').classList.add('d-none');
            document.getElementById('pensionGraph').classList.add('d-none');
        }
    </script>
</body>
</html>