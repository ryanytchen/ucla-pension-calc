<!DOCTYPE html>
<html>
<head>
    <title>Pension Calculator</title>
    <style>
        .data {
            border-collapse: collapse;
            width: 100%;
        }
        .data th, .data td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .data th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #4CAF50;
            color: white;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>UCLA Pension Calculator</h1>
    <form id="pensionForm">
        <label for="currentAge">Current Age:</label>
        <input type="number" id="currentAge" name="currentAge" required><br><br>
        
        <label for="startDateYear">Employment Start Year:</label>
        <input type="number" id="startDateYear" name="startDateYear" required><br><br>
        
        <label for="hapc">Highest Average Salary (HAPC):</label>
        <input type="number" step="0.01" id="hapc" name="hapc" required><br><br>
        
        <input type="submit" value="Calculate">
    </form>
    
    <h2>Pension Calculation Results</h2>
    <div id="results"></div>
    <div id="pensionGraph"></div>

    <script>
        document.getElementById('pensionForm').addEventListener('submit', function(event) {
            event.preventDefault();
            calculatePension();
        });

        function calculatePension() {
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const startDateYear = parseInt(document.getElementById('startDateYear').value);
            const hapc = parseFloat(document.getElementById('hapc').value);

            const currentYear = new Date().getFullYear();
            let ageFactors;

            if (startDateYear < 2013) {
                ageFactors = {
                    50: 0.0110,
                    51: 0.0124,
                    52: 0.0138,
                    53: 0.0152,
                    54: 0.0166,
                    55: 0.0180,
                    56: 0.0194,
                    57: 0.0208,
                    58: 0.0222,
                    59: 0.0236,
                    60: 0.0250
                };
            } else {
                ageFactors = {
                    55: 0.0110,
                    56: 0.0124,
                    57: 0.0138,
                    58: 0.0152,
                    59: 0.0166,
                    60: 0.0180,
                    61: 0.0194,
                    62: 0.0208,
                    63: 0.0222,
                    64: 0.0236,
                    65: 0.0250
                };
            }

            const retirementAges = Object.keys(ageFactors).map(age => parseInt(age));
            const results = [];

            retirementAges.forEach(age => {
                const retirementYear = currentYear + (age - currentAge);
                const serviceYears = retirementYear - startDateYear;
                const ageFactor = ageFactors[age];
                const benefitPercentage = serviceYears * ageFactor;
                const yearlyPension = benefitPercentage * hapc;
                const monthlyPension = yearlyPension / 12;

                results.push({
                    retirementAge: age,
                    retirementYear: retirementYear,
                    serviceYears: serviceYears,
                    benefitPercentage: benefitPercentage * 100,
                    monthlyPension: monthlyPension,
                    yearlyPension: yearlyPension
                });
            });

            displayResults(results);
            displayGraph(results);
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            if (results.length > 0) {
                const table = document.createElement('table');
                table.classList.add('data');

                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');

                ['Retirement Age', 'Retirement Year', 'Service Years', 'Benefit Percentage (%)', 'Monthly Pension ($)', 'Yearly Pension ($)'].forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });

                thead.appendChild(headerRow);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');

                results.forEach(result => {
                    const row = document.createElement('tr');

                    const formattedResult = {
                        retirementAge: result.retirementAge.toFixed(0),
                        retirementYear: result.retirementYear,
                        serviceYears: result.serviceYears.toFixed(0),
                        benefitPercentage: result.benefitPercentage.toFixed(2) + '%',
                        monthlyPension: result.monthlyPension.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 }),
                        yearlyPension: result.yearlyPension.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })
                    };

                    Object.values(formattedResult).forEach(value => {
                        const td = document.createElement('td');
                        td.textContent = value;
                        row.appendChild(td);
                    });

                    tbody.appendChild(row);
                });

                table.appendChild(tbody);
                resultsDiv.appendChild(table);
            } else {
                resultsDiv.textContent = 'No results to display.';
            }
        }

        function displayGraph(results) {
            const retirementAges = results.map(result => result.retirementAge);
            const yearlyPensions = results.map(result => result.yearlyPension);

            const trace = {
                x: retirementAges,
                y: yearlyPensions,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Yearly Pension',
                text: results.map(result => `
                    Retirement Age: ${result.retirementAge}<br>
                    Retirement Year: ${result.retirementYear}<br>
                    Service Years: ${result.serviceYears}<br>
                    Benefit Percentage: ${result.benefitPercentage.toFixed(2)}%<br>
                    Monthly Pension: ${result.monthlyPension.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })}<br>
                    Yearly Pension: ${result.yearlyPension.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 })}
                `),
                hoverinfo: 'text'
            };

            const layout = {
                title: 'UCLA Pension Based on Retirement Age',
                xaxis: { title: 'Retirement Age' },
                yaxis: { title: 'Pension Amount ($)' },
                hovermode: 'closest'
            };

            Plotly.newPlot('pensionGraph', [trace], layout);
        }
    </script>
</body>
</html>
